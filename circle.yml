general:
  branches:

machine:
  pre:
    - sudo rm -rf /usr/local/go
    - curl -L https://storage.googleapis.com/golang/go1.7.linux-amd64.tar.gz | sudo tar xvzf - -C /usr/local

  environment:
    PATH: "/usr/local/go/bin:/usr/local/go_workspace/bin:~/.g /home/ubuntu/.go_project_workspace/bin:${PATH}"
    GOPATH: "${HOME}/go"
    SOURCES: $GOPATH/src/github.com/$CIRCLE_PROJECT_USERNAME 
    WORKDIR: $SOURCES/$CIRCLE_PROJECT_REPONAME

  post:
    - mkdir -p $GOPATH
    - mkdir -p $WORKDIR
    - cp -r $HOME/$CIRCLE_PROJECT_REPONAME $SOURCES

dependencies:
    override:
      - cd $WORKDIR && make deps
      - go get -u github.com/golang/lint/golint

test:
  override:
      - cd $WORKDIR && make lint
      - cd $WORKDIR && make cover

  post:
    - mkdir $CIRCLE_ARTIFACTS/coverage
    - mv $WORKDIR/coverage.txt $CIRCLE_ARTIFACTS/coverage
    - mv $WORKDIR/coverage.html $CIRCLE_ARTIFACTS/coverage
